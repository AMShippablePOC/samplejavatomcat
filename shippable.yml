language: java

jdk:
  - oraclejdk8

branches:
  only:
    - master

env:
  global:
    - secure: QxYtpWedaY1d/YE3/0TTpWglg3MusJkhKPf9GARLnnwj/iRp708bBDTI5lGe3kQ6LnaZgtRfnaYPzpcyDzQvQNFVwlL+jimKXV6L3zH5d/w6006cyVvdlenp8It/JxH+POSvg4T0J6k4m7Q+mV3opJQ/3rdZHlK1JPWmE83HpHqOwpXii2qYbO2di187DybbrOBezF3d9YPa0i5Oj6YoOjoFF+R9BzROE+dpCirFJpzhWHOzvap+nzEmjri3TNfkMkTrmNWTT1sZfpgkP4/eFW0RFWHunBtYWJo5jDoHIANxVZX6UQ3ZS939aOKNyiz5umvORoA3Fi3P/YwyvfyZFg==

build:
  ci:
    - mkdir -p shippable/testresults && mkdir -p shippable/codecoverage
    - sed -i "s/{PASSWORD}/$PASSWORD/" .m2/settings.xml
    - mvn -q -B -s .m2/settings.xml -U clean cobertura:cobertura deploy
    - docker build -t ttrahan/javahelloworld:$BRANCH.$BUILD_NUMBER .
    - docker push ttrahan/javahelloworld:$BRANCH.$BUILD_NUMBER

integrations:
  hub:
    - integrationName: ttrahan-dh
      type: docker

  notifications:
    - integrationName: ttrahan-trigger-javahello
      type: webhook
      payload:
        - versionName=$BRANCH.$BUILD_NUMBER
      branches:
        only:
          - master
      on_success: always
      on_failure: never
      on_start: never
